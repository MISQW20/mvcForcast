@*@Styles.Render("~/Styles/Home.css")*@
@*@Scripts.Render("~/bundles/jquery")*@
@*@Scripts.Render("~/bundles/bootstrap")*@
@*@Scripts.Render("~/Scripts/ForcasteReport.js")*@







<html>
<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    @*<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>*@
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>





    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.css">

    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.js"></script>



    <script>
        var ServerData = null;
        var selectstr = null;
        var RcvedJobs = null;
        var table = null;
        $(document).ready(function () {

            ServerData = $("#customInput").data("value");

            ServerData.forEach(elm => {
                selectstr = selectstr + `<option>` + elm + `</option>`

            })


            $(".selectpicker")
                .html(selectstr)
                .selectpicker('refresh');



            $("select.jobs").change(function () {
                var selectedJobs = new Array();
                $("option:selected").each(function () {
                    selectedJobs.push($(this).val());
                });
                selectstr = selectedJobs.toString();

                $('#btnGet').prop('disabled', false);
                if (selectstr.length == 0) {
                    $('#btnGet').prop('disabled', true);
                }
            });

            $('select').selectpicker();
            $('.selectpicker').selectpicker('refresh');


            $("#btnGet").click(function () {
                $.ajax({
                    async: "true",
                    type: "POST",
                    url: "/Home/RcvJobs",
                    data: JSON.stringify({ jb: selectstr }),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (response) {

                        RcvedJobs = response
                        drawTable(RcvedJobs);
                        console.log(RcvedJobs)
                    },
                    failure: function (response) {
                        alert(response.responseText);
                    },
                    error: function (response) {
                        alert(response.responseText);
                    }
                });
            });
            //initialize tabel here on ready
            var table = $('#GlazingReport').DataTable({
                //"data": input,
                select: "single",
                "searching": false,
                "paging": false,
                "columns": [
                    {
                        "className": 'details-control',
                        "orderable": false,
                        "data": null,
                        "defaultContent": '',
                    },
                    { "data": "job" },
                    

                ],
                "order": [[1, 'asc']]
            });


            //click on data tabel row
            $('#GlazingReport tbody').on('click', 'td.details-control', function () {
                var tr = $(this).closest('tr');
                var tdi = tr.find("i.fa");
                var row = table.row(tr);

                if (row.child.isShown()) {
                    // This row is already open - close it
                    row.child.hide();
                    tr.removeClass('shown');
                    tdi.first().removeClass('fa-minus-square');
                    tdi.first().addClass('fa-plus-square');
                }
                else {
                    // Open this row
                    row.child(format(row.data())).show();
                    tr.addClass('shown');
                    tdi.first().removeClass('fa-plus-square');
                    tdi.first().addClass('fa-minus-square');
                }
            });

        });

        function drawTable(RcvedJobs) {
            
            var Internall = [];
            RcvedJobs.forEach(elm => {

                var flag = true;

                Internall.forEach(elm2 => {
                    if (elm.job == elm2.job) {
                        flag = false;
                    }
                })

                if (flag) {
                    Internall.push(elm);
                }
            })
            

            $('#GlazingReport').DataTable().clear();
            $('#GlazingReport').DataTable().rows.add(Internall).draw(); 
        }
        
        //click on green plus on each rows in tabel trigers this function
        function format(d) {          
            var Internall = [];
            
            RcvedJobs.forEach(elm => {
                var flag = true;
                Internall.forEach(elm2 => {
                    if (elm.job == elm2.job && elm.floor == elm2.floor) {
                        flag = false;
                    }
                })
                if (flag) {
                    Internall.push(elm);
                }
            })
            // `d` is the original data object for the row		
            var temp = '<table style="padding: 0.5%; border: 1px solid #ccc;   border-radius: 3px;margin-left: 1%;margin-right: 1%;"><thead><tr><th>FLOORS</th></tr></thead> <tbody>	';

            Internall.forEach(elm => {
                if (elm.job == d.job) {
                    temp = temp + '<tr><td>' + elm.floor + '</td><td><input class="returning" value= "' + elm.job + "AND" + elm.floor + '" type="checkbox"></td></tr>'
                }                        
            })
                    
           
            temp = temp + ' </tbody></table>'
            return temp
        }





    </script>

    <style>
        h2 {
            font-family: Raleway,sans-serif;
            font-size: 24px;
            font-style: normal;
            font-weight: 500;
            letter-spacing: 4px;
        }
        /*.csTable tr:nth-child(odd){
		background-color: #eaeaea;
		color: #0;
	}*/
        .csTable tr {
            background-color: #fafafa;
            color: #0;
        }

        .trDetails {
            background-color: #fefefe;
            border: solid 1px #dedede;
            display: inline-flex;
            width: 100%;
        }

            .trDetails th, .trDetails td {
                border: solid 1px #dedede;
            }

            .trDetails tr {
                background-color: #fefefe !important;
                color: #0;
            }

            .trDetails th {
                background-color: #DDDDDD;
            }

        .csTable {
            border: 1px solid #cccccc;
        }

            /*.csTable tr:nth-child(even){
		background-color: #fff;
		color: #0;
	}*/

            .csTable td, .csTable th {
                padding-right: 10px;
                height: 30px;
                font-size: 14px;
                padding-left: 10px;
            }

        input {
            width: 120px !important;
            border: 1px solid rgb(221,221,221) !important;
            border-radius: 5px;
            margin-bottom: 5px !important;
            height: 25px !important;
            background-color: white;
        }

            input:disabled {
                cursor: default;
                background-color: #eaeaea;
            }

        #dialog-form > fieldset > input {
            width: 90% !important;
        }

        .ui-dialog .ui-dialog-content {
            overflow: hidden !important;
        }

        fieldset {
            border: 1px solid rgb(221,221,221);
            border-radius: 5px;
            margin-bottom: 11px;
        }

        .csDialogRow {
            xborder: 1px solid black;
            clear: both;
        }

            .csDialogRow > label {
                width: 120px;
                float: left !important;
                xborder: 1px solid black;
            }

            .csDialogRow > input {
                width: 440px !important;
                float: left !important;
                xborder: 1px solid black;
                margin-left: 0px !important;
                margin-top: 0px !important;
                padding-left: 5px !important;
            }

        .row > input:not([type|=radio]):not([type|=checkbox]) {
            padding-left: 5px !important;
        }

        .row > table > tbody > tr > td > input:not([type|=radio]):not([type|=checkbox]) {
            padding-left: 5px !important;
        }

        select {
            border: 1px solid rgb(221,221,221) !important;
            border-radius: 5px;
            padding: 3px 3px 3px 3px;
            margin-bottom: 5px;
            height: 25px;
            font-size: 14px;
        }

        body.landscape > .toolbar > h1 {
            width: 350px !important;
        }

        .csSearch > tbody > tr > td {
            padding-left: 20px;
        }

        .csTData {
            text-align: center;
            font-size: 13px;
        }

        .csTDataAmt {
            text-align: right;
            padding-right: 5px;
            font-size: 13px;
        }

        .csCheckBox {
            width: 20px !important;
        }

        .dataTables_filter {
            text-align: left !important;
        }

        .container-fluid {
            padding: 0px;
        }

        .navbar-brand {
            padding: 15px;
        }

        #searchArea {
        }

            #searchArea input {
                padding: 5px;
                margin-left: 10px;
                margin-top: 3px;
            }

            #searchArea label {
                display: inline-flex;
                align-items: center;
            }

        #GtypesTable button {
            padding: 0px;
            height: 75%;
        }

        .text-responsive {
            font-size: calc(100% + .2vw + .2vh);
        }

        .text-responsive-small {
            font-size: calc(100% + .05vw + .05vh);
        }

        .modal-body label {
            font-size: 14px;
            font-variant: normal;
            font-variant-ligatures: normal;
            font-variant-caps: normal;
            font-variant-numeric: normal;
            font-variant-east-asian: normal;
            white-space: normal;
            line-height: normal;
            font-weight: normal;
            font-style: normal;
            text-transform: capitalize;
            font-family: Arial;
            letter-spacing: 1px;
        }

        .toggle-btn-selector span {
            background-color: #fff;
            border-color: #ccc;
        }

        .toggle-group label {
            font-size: 12px;
        }

        .toggle.btn {
            min-height: 25px;
        }

        .btn-toggle-argon {
            color: #212529;
            background-color: rgb(226, 224, 0);
            border-color: rgb(199, 199, 199);
        }

        .btn-toggle-air {
            color: #fff;
            background-color: #15a9df !important;
            border-color: rgb(199, 199, 199);
        }

        .custom-checkbox .custom-control-input:checked ~ .custom-control-label::before {
            background-color: #15a9df;
        }

        #ddlOT {
            max-width: 63%;
            margin-left: -15px;
        }

        .modal-dialog {
            max-width: max-content;
            margin: 1.75rem auto;
        }

        .modal-body select {
            padding-left: 0rem;
            padding-right: 1rem;
            font-size: 13px;
        }

        .row-modal {
            margin-bottom: 1rem;
        }

        .mr-3-neg {
            margin-right: -1.1rem;
        }

        td.details-control {
            background: url('https://datatables.net/examples/resources/details_open.png') no-repeat center center;
            cursor: pointer;
        }

        tr.shown td.details-control {
            background: url('https://datatables.net/examples/resources/details_close.png') no-repeat center center;
        }

        .tableDetails td {
            text-align: center;
        }

        .tableDetails img {
            width: 1rem;
        }

        .tableDetailsTitle {
            text-align: center;
            margin-top: 1rem;
            height: 30px;
            font-weight: bold;
            background-color: #CCCCCC;
            margin: 1rem 1rem 0rem 1rem;
            padding-top: .35rem;
        }

        .imageGrayscale {
            filter: grayscale(100%) brightness(175%);
            width: .5rem !important;
        }

        legend {
            width: auto;
            border: none;
            margin-left: 1.5rem;
        }

        .mw-45 {
            max-width: 45%;
        }

        .col-1-and-a-half {
            flex: 0 0 8.333333%;
            max-width: 8.333333%;
        }

        select:disabled {
            background-color: #eaeaea;
        }
   </style>

</head>
<body>

    <select id="ddlJobs" class="selectpicker jobs " data-live-search="true" multiple>
    </select>


    <button id="btnGet" disabled>search!</button>


    <div >

        <table id="GlazingReport" class="cell-border compact stripe">
            <thead>
                <tr style="background-color: #CCCCCC;border: solid 1px #555555;">
                    <th></th>
                    <th>JOB</th>
                    
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>


    <input type="hidden" id="customInput" data-value="@ViewBag.json" />
</body>

</html>













